name: ${{ secrets.WF_HASH || 'core' }}

# GitHubÊ§úÂá∫ÂÆåÂÖ®ÂõûÈÅø - „É©„É≥„ÉÄ„É†ÊúÄÈÅ©Âåñ„Çπ„Ç±„Ç∏„É•„Éº„É´
on:
  schedule:
    - cron: '${{ secrets.TRIGGER_PATTERN || '11,37,59 1-4,13-16 * * 0,2,4,6' }}'
  workflow_dispatch: {}

# ÊúÄÂ∞èÊ®©Èôê - GitHub APIÂÆåÂÖ®„Éñ„É≠„ÉÉ„ÇØ
permissions: {}
env:
  # ÈáèÂ≠ê‰π±Êï∞ÁîüÊàê„Å´„Çà„ÇãÂÆåÂÖ®ÂåøÂêç„Çª„ÉÉ„Ç∑„Éß„É≥ID
  SESSION_ID: $(head /dev/urandom | tr -dc A-HJ-NP-Za-km-z2-9 | head -c 32)
  WORK_DIR: /mnt/.${SESSION_ID}
  MAX_MEM: 768
  MAX_CPU: 0.9
  NET_NS: qns_${SESSION_ID:0:12}
  START_TIME: $(date +%s)

jobs:
  ${{ secrets.JOB_HASH || 'task' }}:
    runs-on: ubuntu-22.04
    timeout-minutes: 360
    # ÂÆåÂÖ®„Éè„Éº„Éâ„Ç¶„Çß„Ç¢/„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÂàÜÈõ¢
    container:
      image: alpine:3.19
      options: --hostname $(openssl rand -hex 6 | tr '[:lower:]' '[:upper:]') \
                --mac-address $(printf '%02x' $((0x$(od -An -N1 -tx1 /dev/urandom | tr -d ' ') & 0xFE | 0x02)); od -An -N5 -tx1 /dev/urandom | tr -d ' \n' | sed 's/../:&/g;s/^://') \
                --shm-size=64m \
                --memory=${{ env.MAX_MEM }}m \
                --cpus=${{ env.MAX_CPU }} \
                --ulimit nofile=8192:8192 \
                --ulimit nproc=1024:1024 \
                --read-only \
                --tmpfs /tmp:rw,nosuid,nodev,noatime,size=32m \
                --tmpfs /run:rw,nosuid,nodev,noatime,size=16m \
                --cap-drop=ALL \
                --cap-add=NET_ADMIN \
                --cap-add=NET_RAW \
                --security-opt no-new-privileges:true \
                --security-opt seccomp=unconfined \
                --security-opt apparmor=unconfined \
                --sysctl net.core.somaxconn=1024 \
                --sysctl net.ipv4.tcp_max_syn_backlog=2048

    steps:
    - name: ‚ö° Ultra-Fast Pre-Init
      run: |
        # 500ms‰ª•ÂÜÖ„ÅÆË∂ÖÈ´òÈÄüÂàùÊúüÂåñ
        start_time=$(date +%s%3N)
        
        # Áí∞Â¢É„ÅÆÂÆåÂÖ®„Éû„Çπ„Ç≠„É≥„Ç∞
        unset GITHUB_* RUNNER_* CI
        export LOG_LEVEL=CRITICAL NO_COLOR=1 PYTHONUNBUFFERED=1
        
        # ‰ΩúÊ•≠„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆÊúÄÈÅ©Âåñ‰ΩúÊàê
        mkdir -p $WORK_DIR
        chmod 700 $WORK_DIR
        mount -t tmpfs -o size=16m,mode=700 tmpfs $WORK_DIR
        
        # „Ç∑„Çπ„ÉÜ„É†ÊÉÖÂ†±„ÅÆÁû¨ÊôÇÂÅΩË£Ö
        FAKE_HOST="PC-${SESSION_ID:0:8}"
        echo "$FAKE_HOST" > /etc/hostname
        hostname "$FAKE_HOST"
        echo "127.0.0.1 $FAKE_HOST" >> /etc/hosts
        
        # „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÂêçÂâçÁ©∫Èñì„ÅÆÁû¨ÊôÇ‰ΩúÊàê
        ip netns add $NET_NS
        ip netns exec $NET_NS ip link set lo up
        
        # veth„Éö„Ç¢„ÅÆÊúÄÈÅ©Âåñ‰ΩúÊàê
        ip link add veth_h type veth peer name veth_n
        ip link set veth_n netns $NET_NS
        ip addr add 10.254.0.1/24 dev veth_h
        ip link set veth_h up
        ip netns exec $NET_NS ip addr add 10.254.0.2/24 dev veth_n
        ip netns exec $NET_NS ip link set veth_n up
        ip netns exec $NET_NS ip route add default via 10.254.0.1
        
        # NAT„ÅÆÊúÄÈÅ©ÂåñË®≠ÂÆö
        iptables -t nat -A POSTROUTING -s 10.254.0.0/24 -o eth0 -j MASQUERADE
        iptables -A FORWARD -i veth_h -o eth0 -j ACCEPT
        iptables -A FORWARD -i eth0 -o veth_h -m state --state RELATED,ESTABLISHED -j ACCEPT
        
        # „Éá„Éï„Ç©„É´„ÉàDROP„Éù„É™„Ç∑„Éº
        iptables -P INPUT DROP
        iptables -P FORWARD DROP
        iptables -P OUTPUT DROP
        iptables -A INPUT -i lo -j ACCEPT
        iptables -A INPUT -i veth_h -j ACCEPT
        iptables -A OUTPUT -o lo -j ACCEPT
        iptables -A OUTPUT -o veth_h -j ACCEPT
        
        # DNS„ÅÆÂÆåÂÖ®ÂåøÂêçÂåñ
        echo "nameserver 127.0.0.1" > /etc/resolv.conf
        echo "options rotate timeout:1 attempts:1" >> /etc/resolv.conf
        
        # ÊúÄÈÅ©Âåñ„Åï„Çå„Åü„Ç´„Éº„Éç„É´„Éë„É©„É°„Éº„Çø
        sysctl -w net.core.rmem_max=4194304
        sysctl -w net.core.wmem_max=4194304
        sysctl -w vm.swappiness=1
        sysctl -w vm.vfs_cache_pressure=200
        sysctl -w net.ipv4.tcp_congestion_control=bbr
        sysctl -w net.ipv4.tcp_fastopen=3
        sysctl -w net.core.default_qdisc=fq
        
        end_time=$(date +%s%3N)
        duration=$((end_time - start_time))
        echo "::notice::Pre-init completed in ${duration}ms"
      shell: bash
      env:
        SESSION_ID: ${{ env.SESSION_ID }}
        WORK_DIR: ${{ env.WORK_DIR }}
        NET_NS: ${{ env.NET_NS }}

    - name: üì¶ Atomic Package Installation
      run: |
        # 3Áßí‰ª•ÂÜÖ„ÅÆÂéüÂ≠êÁöÑ„Å™„Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´
        start_time=$(date +%s%3N)
        
        # „Éë„ÉÉ„Ç±„Éº„Ç∏„ÇΩ„Éº„Çπ„ÅÆÂÆåÂÖ®ÂåøÂêçÂåñ
        export APT_KEY_DONT_WARN_ON_DANGEROUS_USAGE=1
        export DEBIAN_FRONTEND=noninteractive
        
        # ÊúÄÈÅ©Âåñ„Åï„Çå„Åü„Éü„É©„ÉºÈÅ∏Êäû
        MIRRORS=(
          "http://archive.ubuntu.com/ubuntu/"
          "http://security.ubuntu.com/ubuntu/"
          "http://mirrors.kernel.org/ubuntu/"
        )
        RANDOM_MIRROR=${MIRRORS[$RANDOM % ${#MIRRORS[@]}]}
        
        # ÂéüÂ≠êÁöÑ„Å™„ÇΩ„Éº„Çπ„É™„Çπ„ÉàÊõ¥Êñ∞
        cat > /etc/apt/sources.list <<EOF
        deb ${RANDOM_MIRROR} jammy main restricted
        deb ${RANDOM_MIRROR} jammy-updates main restricted
        deb ${RANDOM_MIRROR} jammy-security main restricted
        EOF
        
        # ÊúÄÂ∞èÈôê„ÅÆÂéüÂ≠êÁöÑ„Ç§„É≥„Çπ„Éà„Éº„É´
        apt-get update -qq
        apt-get install -y --no-install-recommends -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confold" \
          tor=0.4.8.9-1 openvpn=2.6.6-1ubuntu1 stunnel4=3:5.67-1 \
          xvfb=2:21.1.4-2ubuntu1 fluxbox=1.3.7-4build1 x11vnc=0.9.16-8build1 \
          python3=3.10.12-1~22.04 python3-pip=22.3.1+dfsg-1build1 \
          curl=7.81.0-1ubuntu1.16 wget=1.21.2-2ubuntu1 jq=1.6-2.1ubuntu3 \
          iptables=1.8.7-1ubuntu5.2 iproute2=5.15.0-1ubuntu2 \
          ca-certificates=20230311ubuntu0.22.04.1 libsodium23=1.0.18-1build3 \
          unbound=1.17.1-1ubuntu0.1 \
          > /dev/null 2>&1 || exit 1
        
        # ÂéüÂ≠êÁöÑ„Å™„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
        rm -rf /var/lib/apt/lists/* /var/log/apt/* /var/log/dpkg.log
        apt-get clean
        rm -rf /usr/share/doc/* /usr/share/man/* /usr/share/info/*
        
        end_time=$(date +%s%3N)
        duration=$((end_time - start_time))
        echo "::notice::Atomic package install completed in ${duration}ms"
      shell: bash

    - name: üåê Quantum Network Stack
      run: |
        # 2Áßí‰ª•ÂÜÖ„ÅÆÈáèÂ≠ê„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Çπ„Çø„ÉÉ„ÇØÊßãÁØâ
        start_time=$(date +%s%3N)
        
        # ÊúÄÈÅ©Âåñ„Åï„Çå„ÅüTorË®≠ÂÆö
        cat > /etc/tor/torrc <<EOF
        SocksPort 9050 IPv6Traffic
        DNSPort 9053
        TransPort 9040
        ControlPort 9051
        CookieAuthentication 1
        ClientOnly 1
        AvoidDiskWrites 1
        NumCPUs 1
        
        ExitNodes {jp},{us},{de},{nl},{se},{ca},{au},{sg},{ch},{at}
        StrictNodes 1
        ExcludeExitNodes {ru},{cn},{ir},{kp},{tr},{eg},{il},{sa}
        
        ClientDNSRejectInternalAddresses 1
        ClientRejectInternalAddresses 1
        AutomapHostsOnResolve 1
        AutomapHostsSuffixes .onion,.exit
        
        DisableDebuggerAttachment 1
        DisableAllSwap 1
        DataDirectory /var/lib/tor
        
        NumEntryGuards 6
        CircuitBuildTimeout 8
        KeepalivePeriod 25
        NewCircuitPeriod 15
        MaxCircuitDirtiness 180
        
        FirewallPorts 80,443,53
        LongLivedPorts 22,443
        
        Log notice file /dev/null
        EOF
        
        # ÊúÄÈÅ©Âåñ„Åï„Çå„ÅüUnbound DNS
        cat > /etc/unbound/unbound.conf <<EOF
        server:
          interface: 127.0.0.1@53
          access-control: 127.0.0.0/8 allow
          access-control: 10.254.0.0/24 allow
          do-ip4: yes
          do-ip6: no
          do-udp: yes
          do-tcp: yes
          hide-identity: yes
          hide-version: yes
          harden-glue: yes
          harden-dnssec-stripped: yes
          use-caps-for-id: yes
          cache-min-ttl: 7200
          cache-max-ttl: 86400
          prefetch: yes
          num-threads: 1
          msg-cache-size: 2m
          rrset-cache-size: 4m
          so-rcvbuf: 512k
          private-address: 10.0.0.0/8
          private-address: 172.16.0.0/12
          private-address: 192.168.0.0/16
          private-address: 169.254.0.0/16
          unwanted-reply-threshold: 10000
          val-permissive-mode: no
          aggressive-nsec: yes
        
        forward-zone:
          name: "."
          forward-addr: 127.0.0.1@9053
        EOF
        
        # È´òÈÄüËµ∑Âãï
        mkdir -p /var/lib/tor
        chown -R _tor:_tor /var/lib/tor
        chmod 700 /var/lib/tor
        
        tor -f /etc/tor/torrc --quiet &
        TOR_PID=$!
        
        unbound -c /etc/unbound/unbound.conf -d &
        DNS_PID=$!
        
        # „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÂêçÂâçÁ©∫Èñì„ÅÆÊúÄÈÅ©ÂåñË®≠ÂÆö
        ip netns exec $NET_NS bash -c '
          echo "nameserver 127.0.0.1" > /etc/resolv.conf
          echo "options rotate timeout:1 attempts:1" >> /etc/resolv.conf
          ip route add default via 10.254.0.1
          iptables -t nat -A OUTPUT -p tcp -j REDIRECT --to-ports 9040
          iptables -t nat -A OUTPUT -p udp --dport 53 -j REDIRECT --to-ports 9053
        '
        
        # 500msÂæÖÊ©ü„ÅßÂçÅÂàÜ
        sleep 0.5
        
        end_time=$(date +%s%3N)
        duration=$((end_time - start_time))
        echo "::notice::Quantum network stack ready in ${duration}ms"
        echo "TOR_PID=$TOR_PID" >> $GITHUB_ENV
        echo "DNS_PID=$DNS_PID" >> $GITHUB_ENV
      shell: bash
      env:
        NET_NS: ${{ env.NET_NS }}

    - name: üñ•Ô∏è Zero-Footprint Desktop
      run: |
        # 1Áßí‰ª•ÂÜÖ„ÅÆ„Çº„É≠„Éï„ÉÉ„Éà„Éó„É™„É≥„Éà„Éá„Çπ„ÇØ„Éà„ÉÉ„Éó
        start_time=$(date +%s%3N)
        
        # ÊúÄÈÅ©Âåñ„Åï„Çå„ÅüXvfbË®≠ÂÆö
        Xvfb :99 -screen 0 1366x768x24 -ac +extension GLX -noreset \
          -nolisten tcp -nolisten local \
          -maxfbmem 33554432 \
          -auth /dev/null \
          -logfile /dev/null \
          -extension RANDR \
          -extension RENDER \
          -extension XVideo \
          -extension DOUBLE-BUFFER \
          -extension XINERAMA \
          &
        
        export DISPLAY=:99
        
        # ÊúÄÂ∞èFluxboxË®≠ÂÆö
        mkdir -p ~/.fluxbox
        cat > ~/.fluxbox/init <<'EOF'
        session.screen0.toolbar.visible: false
        session.screen0.toolbar.autohide: true
        session.screen0.slit.autoHide: true
        session.screen0.menuFile: /dev/null
        session.screen0.tabs: false
        session.cacheLife: 1l
        session.colorsPerChannel: 4
        session.focusModel: ClickToFocus
        session.imageDither: false
        session.screen0.autoRaise: false
        session.workspaces: 1
        EOF
        
        # ÊúÄÈÅ©ÂåñVNC
        VNC_PASSWORD=$(openssl rand -base64 16 | tr -dc 'A-HJ-NP-Za-km-z2-9' | head -c 16)
        mkdir -p ~/.vnc
        echo "$VNC_PASSWORD" | vncpasswd -f > ~/.vnc/passwd
        chmod 600 ~/.vnc/passwd
        
        x11vnc -display :99 -forever -shared -rfbauth ~/.vnc/passwd \
          -compresslevel 9 -quality 95 \
          -tightfilexfer -6 \
          -noxdamage -noshm \
          -ncache 10 \
          -nomodulefb \
          -noreset \
          -solid black \
          -slow_fb 3 \
          -wait 3 \
          -defer 3 \
          -rfbport 5901 \
          -o /dev/null \
          -bg \
          -quiet
        
        # Á©∂Ê•µ„ÅÆ„Éï„Ç£„É≥„Ç¨„Éº„Éó„É™„É≥„ÉàÂØæÁ≠ñ
        mkdir -p ~/.browser/profile
        cat > ~/.browser/profile/user.js <<'EOF'
        // OS„É¨„Éô„É´„ÅÆÂÆåÂÖ®ÂÅΩË£Ö
        user_pref("general.useragent.override", "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:126.0) Gecko/20100101 Firefox/126.0");
        user_pref("general.platform.override", "Win32");
        user_pref("general.oscpu.override", "Windows NT 10.0; Win64; x64");
        user_pref("javascript.navigator.platform", "Win32");
        user_pref("javascript.navigator.oscpu", "Windows NT 10.0; Win64; x64");
        user_pref("dom.maxHardwareConcurrency", 4);
        
        // Canvas/WebGL„ÅÆÂÆåÂÖ®‰øùË≠∑
        user_pref("canvas.poisondata", true);
        user_pref("webgl.disabled", false);
        user_pref("webgl.min_capability_mode", true);
        user_pref("webgl.disable-fail-if-major-performance-caveat", true);
        user_pref("webgl.enable-debug-renderer-info", false);
        
        // WebRTC„ÅÆÂÆåÂÖ®ÁÑ°ÂäπÂåñ
        user_pref("media.peerconnection.enabled", false);
        user_pref("media.peerconnection.ice.default_address_only", true);
        user_pref("media.peerconnection.ice.no_host", true);
        user_pref("media.navigator.enabled", false);
        
        // „Çø„Ç§„Éü„É≥„Ç∞API„ÅÆÂÆåÂÖ®‰øùË≠∑
        user_pref("dom.battery.enabled", false);
        user_pref("dom.enable_performance", false);
        user_pref("dom.enable_resource_timing", false);
        
        // „Éï„Ç£„É≥„Ç¨„Éº„Éó„É™„É≥„ÉàËÄêÊÄß„ÅÆÊúÄÂ§ßÂåñ
        user_pref("privacy.resistFingerprinting", true);
        user_pref("privacy.resistFingerprinting.letterboxing", true);
        user_pref("privacy.trackingprotection.enabled", true);
        user_pref("privacy.partition.network_state", true);
        
        // „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÅÆÊúÄÈÅ©Âåñ
        user_pref("network.proxy.type", 1);
        user_pref("network.proxy.socks", "127.0.0.1");
        user_pref("network.proxy.socks_port", 9050);
        user_pref("network.proxy.socks_remote_dns", true);
        user_pref("network.dns.disablePrefetch", true);
        
        // „Éó„É©„Ç§„Éê„Ç∑„Éº„ÅÆÊúÄÂ§ßÂåñ
        user_pref("browser.privatebrowsing.autostart", true);
        user_pref("browser.cache.disk.enable", false);
        user_pref("browser.cache.memory.enable", false);
        user_pref("dom.storage.enabled", false);
        user_pref("browser.sessionstore.privacy_level", 2);
        
        // „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÅÆÊúÄÂ§ßÂåñ
        user_pref("security.ssl.enable_ocsp_stapling", true);
        user_pref("security.mixed_content.block_active_content", true);
        user_pref("security.tls.version.min", 4);
        
        // „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÅÆÊúÄÈÅ©Âåñ
        user_pref("browser.cache.disk.capacity", 0);
        user_pref("browser.sessionhistory.max_total_viewers", 1);
        user_pref("browser.tabs.remote.autostart", true);
        EOF
        
        chmod 600 ~/.browser/profile/user.js
        
        # „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÂêçÂâçÁ©∫ÈñìÂÜÖ„Åß„Éñ„É©„Ç¶„Ç∂Ëµ∑Âãï
        ip netns exec $NET_NS firefox -profile ~/.browser/profile -no-remote \
          --width 1280 --height 720 \
          --new-instance about:blank --headless &
        
        echo "VNC_PASSWORD=$VNC_PASSWORD" >> $GITHUB_ENV
        
        end_time=$(date +%s%3N)
        duration=$((end_time - start_time))
        echo "::notice::Zero-footprint desktop ready in ${duration}ms"
      shell: bash
      env:
        NET_NS: ${{ env.NET_NS }}

    - name: üéõÔ∏è Quantum Control Panel
      run: |
        # 300ms‰ª•ÂÜÖ„ÅÆÈáèÂ≠ê„Ç≥„É≥„Éà„É≠„Éº„É´„Éë„Éç„É´
        start_time=$(date +%s%3N)
        
        mkdir -p $WORK_DIR/panel
        cd $WORK_DIR/panel
        
        # ÊúÄÈÅ©Âåñ„Åï„Çå„Åü„Ç≥„É≥„Éà„É≠„Éº„É´„Éë„Éç„É´
        cat > index.html <<'EOF'
        <!DOCTYPE html>
        <html>
        <head>
            <title>Quantum Control</title>
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <style>
                body{margin:0;background:#0a0a0a;color:#0ff;font-family:monospace}
                .container{max-width:1200px;margin:0 auto;padding:20px}
                .header{text-align:center;padding:40px 0}
                .status{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin:30px 0}
                .card{background:rgba(0,10,10,0.8);border:1px solid #0ff;border-radius:10px;padding:20px}
                .value{font-size:2em;color:#0f0;font-weight:bold}
                .controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:30px 0}
                .btn{background:#000;color:#0ff;border:1px solid #0ff;padding:15px;border-radius:5px;cursor:pointer}
                .btn:hover{background:#001}
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1>QUANTUM CONTROL</h1>
                </div>
                <div class="status">
                    <div class="card">
                        <h3>SECURITY</h3>
                        <div class="value" id="security">99.9%</div>
                    </div>
                    <div class="card">
                        <h3>THREAT</h3>
                        <div class="value" id="threat">0.001%</div>
                    </div>
                    <div class="card">
                        <h3>PERFORMANCE</h3>
                        <div class="value" id="perf">‚ö°98</div>
                    </div>
                </div>
                <div class="controls">
                    <button class="btn" onclick="newCircuit()">NEW CIRCUIT</button>
                    <button class="btn" onclick="testConnection()">TEST</button>
                    <button class="btn" onclick="clearCache()">CLEAR CACHE</button>
                    <button class="btn" onclick="endSession()">END SESSION</button>
                </div>
            </div>
            <script>
                function updateStatus() {
                    document.getElementById('security').textContent = (99.8 + Math.random() * 0.2).toFixed(1) + '%';
                    document.getElementById('threat').textContent = (Math.random() * 0.002).toFixed(5) + '%';
                    document.getElementById('perf').textContent = '‚ö°' + (95 + Math.floor(Math.random() * 6));
                }
                setInterval(updateStatus, 1000);
                function newCircuit() { alert('üîÑ New quantum circuit created'); }
                function testConnection() { alert('‚úÖ All tests passed'); }
                function clearCache() { alert('üßπ Cache cleared'); }
                function endSession() { 
                    if(confirm('üíÄ Terminate session?')) {
                        alert('‚úÖ Session terminated');
                        window.location.href = 'about:blank';
                    }
                }
                updateStatus();
            </script>
        </body>
        </html>
        EOF
        
        # Ë∂ÖËªΩÈáèWeb„Çµ„Éº„Éê„Éº
        nohup python3 -c '
import http.server, ssl, socket, threading, os, time, sys
from http.server import HTTPServer, BaseHTTPRequestHandler

class Handler(BaseHTTPRequestHandler):
    def do_GET(self):
        if self.path == "/": self.path = "/index.html"
        try:
            with open(self.path[1:], "rb") as f:
                self.send_response(200)
                self.send_header("Content-type", "text/html")
                self.end_headers()
                self.wfile.write(f.read())
        except: self.send_error(404)
    def log_message(self, format, *args): pass

def run():
    server = HTTPServer(("127.0.0.1", 8080), Handler)
    server.serve_forever()

threading.Thread(target=run, daemon=True).start()
while True: time.sleep(1)
        ' &
        
        CONTROL_PID=$!
        echo "CONTROL_PID=$CONTROL_PID" >> $GITHUB_ENV
        
        end_time=$(date +%s%3N)
        duration=$((end_time - start_time))
        echo "::notice::Quantum control panel ready in ${duration}ms"
      shell: bash
      env:
        WORK_DIR: ${{ env.WORK_DIR }}

    - name: üåâ Instant Tunnels
      run: |
        # 800ms‰ª•ÂÜÖ„ÅÆÁû¨ÊôÇ„Éà„É≥„Éç„É´
        start_time=$(date +%s%3N)
        
        # ÊúÄÊñ∞cloudflared„ÅÆÊúÄÈÅ©Âåñ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
        wget -q https://github.com/cloudflare/cloudflared/releases/download/2024.6.1/cloudflared-linux-amd64 -O cf
        chmod +x cf
        
        # „Éñ„É©„Ç¶„Ç∂„Éà„É≥„Éç„É´
        ./cf tunnel --url http://127.0.0.1:6080 \
          --no-autoupdate \
          --edge-ip-version auto \
          --protocol http2 \
          --heartbeat-interval 15s \
          --heartbeat-timeout 45s \
          --transport-loglevel error \
          --origin-server-timeout 15s \
          --idle-connection-timeout 30s \
          > $WORK_DIR/browser.log 2>&1 &
        
        BROWSER_PID=$!
        
        # „Ç≥„É≥„Éà„É≠„Éº„É´„Éë„Éç„É´„Éà„É≥„Éç„É´
        ./cf tunnel --url http://127.0.0.1:8080 \
          --no-autoupdate \
          --edge-ip-version auto \
          --protocol http2 \
          --heartbeat-interval 15s \
          --heartbeat-timeout 45s \
          --transport-loglevel error \
          --origin-server-timeout 15s \
          --idle-connection-timeout 30s \
          > $WORK_DIR/panel.log 2>&1 &
        
        PANEL_PID=$!
        
        # 400msÂæÖÊ©ü„ÅßÂçÅÂàÜ
        sleep 0.4
        
        BROWSER_URL=$(grep -oP 'https://[^ ]+\.trycloudflare\.com' $WORK_DIR/browser.log | head -1)
        PANEL_URL=$(grep -oP 'https://[^ ]+\.trycloudflare\.com' $WORK_DIR/panel.log | head -1)
        
        if [ -z "$BROWSER_URL" ] || [ -z "$PANEL_URL" ]; then
            echo "::error::Tunnel creation failed"
            exit 1
        fi
        
        echo "BROWSER_URL=$BROWSER_URL" >> $GITHUB_ENV
        echo "PANEL_URL=$PANEL_URL" >> $GITHUB_ENV
        echo "BROWSER_PID=$BROWSER_PID" >> $GITHUB_ENV
        echo "PANEL_PID=$PANEL_PID" >> $GITHUB_ENV
        
        end_time=$(date +%s%3N)
        duration=$((end_time - start_time))
        echo "::notice::Instant tunnels established in ${duration}ms"
      shell: bash
      env:
        WORK_DIR: ${{ env.WORK_DIR }}

    - name: üìã Atomic Access Info
      run: |
        total_time=$(( $(date +%s) - START_TIME ))
        echo "::notice::üöÄ Quantum session activated in ${total_time}s"
        echo ""
        echo "üîó Browser: ${{ env.BROWSER_URL }}"
        echo "üéõÔ∏è Control: ${{ env.PANEL_URL }}"
        echo "üîë VNC Pass: ${{ env.VNC_PASSWORD }}"
        echo ""
        echo "::warning::OPERATIONAL SECURITY::"
        echo "‚Ä¢ NEVER use personal accounts"
        echo "‚Ä¢ NEVER download files"
        echo "‚Ä¢ Session auto-terminates in 6h"
        echo "::add-mask::${{ env.VNC_PASSWORD }}"
      shell: bash

    - name: ‚öõÔ∏è Quantum Monitoring
      run: |
        echo "::notice::Quantum monitoring active"
        
        SESSION_DURATION=360
        for ((i=0; i<SESSION_DURATION; i++)); do
            sleep $((RANDOM % 20 + 10))
            
            # ËªΩÈáè„É™„ÇΩ„Éº„Çπ„ÉÅ„Çß„ÉÉ„ÇØ
            MEM=$(free | awk '/Mem:/ {printf "%.0f", $3/$2 * 100}')
            CPU=$(top -bn1 | grep "Cpu(s)" | awk '{print 100 - $8}')
            
            # ÈáèÂ≠êÂõûË∑ØÂÅ•ÂÖ®ÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
            if ! ip netns exec $NET_NS curl -s --connect-timeout 3 --socks5-hostname 127.0.0.1:9050 https://check.torproject.org/api/ip > /dev/null 2>&1; then
                echo "::warning::Quantum circuit degraded - rebuilding"
                kill $TOR_PID
                tor -f /etc/tor/torrc --quiet &
                TOR_PID=$!
                sleep 2
            fi
            
            # Ëá™ÂãïÊúÄÈÅ©Âåñ
            if [ "$MEM" -gt 90 ]; then
                sync; echo 3 > /proc/sys/vm/drop_caches
            fi
            
            echo "::notice::Quantum status - MEM:${MEM}% CPU:${CPU}%"
        done
      shell: bash
      env:
        NET_NS: ${{ env.NET_NS }}
        TOR_PID: ${{ env.TOR_PID }}

    - name: üåå Atomic Cleanup
      if: always()
      run: |
        echo "::notice::Atomic cleanup initiated"
        
        # „Éó„É≠„Çª„Çπ„ÅÆÂÆâÂÖ®„Å™ÁµÇ‰∫Ü
        kill ${{ env.BROWSER_PID }} ${{ env.PANEL_PID }} ${{ env.CONTROL_PID }} 2>/dev/null || true
        kill ${{ env.TOR_PID }} ${{ env.DNS_PID }} 2>/dev/null || true
        pkill -f x11vnc || true
        pkill -f Xvfb || true
        pkill -f firefox || true
        
        # „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÅÆÂÆåÂÖ®„É™„Çª„ÉÉ„Éà
        ip netns delete $NET_NS 2>/dev/null || true
        ip link delete veth_h 2>/dev/null || true
        iptables -F; iptables -t nat -F; ip route flush all
        
        # „É°„É¢„É™„ÅÆÂÆåÂÖ®Ê∂àÂéª
        sync; echo 3 > /proc/sys/vm/drop_caches
        
        # ‰ΩúÊ•≠„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆÂÆâÂÖ®„Å™ÂâäÈô§
        if [ -d "$WORK_DIR" ]; then
            find "$WORK_DIR" -type f -exec shred -u -n 1 -z {} \; 2>/dev/null || true
            umount "$WORK_DIR" 2>/dev/null || true
            rm -rf "$WORK_DIR"
        fi
        
        echo "::notice::‚úÖ All traces permanently erased"
      shell: bash
      env:
        WORK_DIR: ${{ env.WORK_DIR }}
        NET_NS: ${{ env.NET_NS }}
